# Epic 6 Retrospective - Scripting & Automation

**Date:** 2025-12-25
**Facilitator:** Bob (Scrum Master)
**Participants:** Alice (Product Owner), Charlie (Senior Dev), Dana (QA Engineer), Elena (Junior Dev), Jongkuk Lim (Project Lead)

---

## Epic Summary

| Metric | Value |
|--------|-------|
| **Epic** | Epic 6: Scripting & Automation |
| **Goal** | CLI commands for automation and scripting |
| **Stories Completed** | 7 of 7 (100%) |
| **Key Outcome** | Complete scripting API with JSON output, exit codes, shell completion, quiet mode |

### Stories Delivered

| Story | Title | Status | Key Achievement |
|-------|-------|--------|-----------------|
| 6.1 | JSON Output Format | done | API versioning, all fields including waiting detection, nullable patterns |
| 6.2 | Project Status Command | done | Plain text + JSON output, lookup by name/displayName/path |
| 6.3 | Exit Codes | done | Standardized 0-4 codes, ErrConfigInvalid wrapping, SilenceErrors pattern |
| 6.4 | Project Exists Check | done | Silent command, SilentError pattern introduced |
| 6.5 | Rename Project Command | done | --clear flag, idempotent behavior |
| 6.6 | Shell Completion | done | Bash/Zsh/Fish/PowerShell, project name completions for 6 commands |
| 6.7 | Quiet and Force Flags | done | Global --quiet/-q flag, suppresses success output |

### Code Review Findings (Applied)

- Story 6.1: Fixed `detection_reasoning` JSON tag inconsistency (removed `omitempty`)
- Story 6.4: Created `SilentError` type to fix main.go logging silent command errors
- Story 6.5: Added edge case tests for `"" --clear` combination
- Story 6.6: Fixed wrong file reference in completion test comment

---

## What Went Well

1. **Strong Pattern Reuse**
   - `findProjectByIdentifier()` reused across 4 commands (status, exists, rename, lookup)
   - `SilenceErrors/SilenceUsage` pattern consistent across all error-handling commands
   - `ProjectSummary` struct reused for JSON output
   - No code duplication despite 7 stories

2. **SilentError Pattern Innovation**
   - Story 6.4 introduced `SilentError` type for truly silent commands
   - Wraps errors to signal "don't log" while preserving exit code mapping
   - Clean solution to main.go logging all errors to stderr

3. **Shell Completion for All Commands**
   - Story 6.6 added `ValidArgsFunction: projectCompletionFunc` to 6 commands
   - Both `Name` and `DisplayName` available as completion candidates
   - Completion scripts for all 4 major shells (bash, zsh, fish, powershell)

4. **Dev Notes Quality**
   - Exact line numbers for modifications
   - Anti-patterns tables prevented mistakes
   - Copy-paste code snippets for consistency
   - Code review caught real issues

5. **Smooth Story Progression**
   - JSON output (6.1) -> status command (6.2) -> exit codes (6.3) -> exists (6.4) -> rename (6.5) -> completion (6.6) -> quiet flags (6.7)
   - Each story built on previous patterns
   - No rework or story changes during sprint

---

## What Didn't Go Well

1. **Carry-Forward Items Still Pending (6th Time)**
   - M2: Shared test helpers package - deferred since Epic 3
   - M3: Shared styles package - deferred since Epic 3
   - **DECISION: Prioritize in Epic 7** (finally!)

2. **DRY Violation (Minor Technical Debt)**
   - `favorite.go` and `note.go` duplicate project lookup logic (~20 lines each)
   - Should use `findProjectByIdentifier()` from status.go
   - **DECISION: Bundle refactoring with M2 in Epic 7**

3. **New Stage Detection Gaps Identified**
   - G24 (NEW): Epic marked as "deferred" causes "Unknown status" in dashboard
   - G23 (from 4.6): Retrospective stage detection still pending
   - **DECISION: Fix both in Epic 7**

---

## Previous Retrospective Follow-Up (Epic 4.6)

| # | Action Item | Status | Notes |
|---|-------------|--------|-------|
| H1 | Decide M2/M3 fate | **RESOLVED** | Prioritize in Epic 7 |
| H2 | Automate build verification | **COMPLETE** | Makefile is sufficient for local-only repo |
| M1 | Fix G23: Retrospective stage detection | **MOVED TO EPIC 7** | Fix with new G24 issue |

---

## New Issues Identified

| ID | Scenario | Current Behavior | Expected Behavior | Priority |
|----|----------|------------------|-------------------|----------|
| **G24** | Epic marked as "deferred" | "Unknown status" | Skip deferred epics in stage detection | HIGH |
| **G24.1** | LLM variations of "deferred" | Not normalized | Handle: deferred, Deferred, epic-deferred, deferred_epic, etc. | HIGH |

**Context for G24:** Epic 5 (Hibernation) was marked as "deferred" in sprint-status.yaml. The stage detection logic doesn't handle this state, causing "Unknown status" in the TUI dashboard. The fix should:
1. Normalize "deferred" variations (like `normalizeStatus()` in 4.6.3)
2. Skip deferred epics when determining current stage
3. Show meaningful status when all active epics are complete

---

## Action Items

### High Priority (Epic 7)

| # | Action Item | Owner | Notes |
|---|-------------|-------|-------|
| H1 | **Implement M2: Shared test helpers package** | Dev Team | 6th time - finally prioritized |
| H2 | **Implement M3: Shared styles package** | Dev Team | 6th time - finally prioritized |
| H3 | **Fix G24: Deferred epic handling** | Dev Team | Skip deferred, normalize variations |
| H4 | **Fix G23: Retrospective stage detection** | Dev Team | Fix with G24 |
| H5 | **DRY refactoring: favorite.go/note.go** | Dev Team | Bundle with M2, use findProjectByIdentifier |

### Decisions Made This Retrospective

| # | Decision | Choice |
|---|----------|--------|
| D1 | M2/M3 fate | Prioritize in Epic 7 |
| D2 | DRY refactoring | Bundle with M2 as sub-task |
| D3 | H2 (CI automation) | COMPLETE - Makefile sufficient for local repo |
| D4 | G24 (deferred epics) | Skip deferred with normalization in Epic 7 |
| D5 | G23 (retrospective detection) | Fix in Epic 7 with G24 |

---

## Lessons Learned

1. **Pattern reuse pays off** - `findProjectByIdentifier()`, `SilenceErrors`, `ProjectSummary` all saved time and prevented bugs.

2. **Dev Notes with line numbers work** - Exact locations and anti-patterns tables made stories unambiguous for implementation.

3. **Shell completion is easy with Cobra** - Story 6.6 was straightforward using Cobra's built-in Gen*Completion methods.

4. **SilentError is a reusable pattern** - When commands need to communicate only via exit code, wrap errors with SilentError.

5. **LLM normalization is recurring** - G24.1 shows we need normalization for any LLM-generated field (status, epic status, etc.).

6. **Carry-forward items need decisive action** - 6 deferrals is too many; explicit prioritization decisions prevent drift.

---

## Epic 7 Readiness Assessment

| Dimension | Status | Notes |
|-----------|--------|-------|
| Dependencies on Epic 6 | None | Error handling independent of scripting API |
| Blocking Issues | **G24** | Dashboard shows "Unknown status" - needs fix before Epic 7 or as first story |
| Technical Debt | M2/M3/DRY | All scheduled for Epic 7 |
| Team Readiness | Ready | No knowledge gaps |

**Epic 7: Error Handling & Polish**
- 7.1: File Watcher Error Recovery
- 7.2: Configuration Error Handling
- 7.3: Database Recovery
- 7.4: Progress Indicators
- Plus: M2, M3, G23, G24, DRY refactoring

**Recommendation:**
1. Address G24 (deferred epic handling) first - it's blocking the dashboard
2. Bundle M2/M3 and DRY refactoring early in Epic 7
3. Then proceed with error handling stories

---

## Retrospective Metrics

| Metric | Value |
|--------|-------|
| Issues Identified | 3 (DRY violation, G24 new, carry-forward items) |
| Action Items Created | 5 high priority for Epic 7 |
| Root Causes Found | 1 (LLM-generated fields need normalization) |
| Patterns Recognized | SilentError, Dev Notes quality, pattern reuse |
| Previous Items Resolved | 2 (H1 decision made, H2 complete) |

---

*Retrospective facilitated by Bob (Scrum Master)*
*Document generated: 2025-12-25*
