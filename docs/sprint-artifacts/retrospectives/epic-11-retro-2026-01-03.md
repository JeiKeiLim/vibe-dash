# Epic 11 Retrospective - Project State & Hibernation

**Date:** 2026-01-03
**Facilitator:** Bob (Scrum Master)
**Participants:** Alice (Product Owner), Charlie (Senior Dev), Dana (QA Engineer), Elena (Junior Dev), Jongkuk Lim (Project Lead)

---

## Epic Summary

| Metric | Value |
|--------|-------|
| **Epic** | Epic 11: Project State & Hibernation |
| **Goal** | Enable project hibernation for inactive projects and auto-activation on activity |
| **Stories Completed** | 7/7 (100%) |
| **Origin** | Deferred from MVP (was Epic 5), prioritized after Epic 9.5 stability work |
| **Key Feature** | Hibernation keeps dashboard focused on active work |

### Stories Delivered

| Story | Title | Key Achievement |
|-------|-------|-----------------|
| 11-1 | Project State Model | `HibernatedAt` field, `StateService`, migration v3 |
| 11-2 | Auto-Hibernation | `HibernationService` with hourly checks |
| 11-3 | Auto-Activation on Activity | `StateActivator` interface, auto-wake on file events |
| 11-4 | Hibernated Projects View | `viewModeHibernated`, `h` key toggle, Enter to wake |
| 11-5 | Manual State Control | `vibe hibernate` & `vibe activate` CLI commands |
| 11-6 | Hibernation Threshold Configuration | `vibe config set hibernation-days`, per-project override |
| 11-7 | TUI Manual State Toggle | `H` key for hibernate/activate in TUI |

---

## Previous Retrospective Follow-Up (Epic 9.5)

| # | Action Item | Status | Notes |
|---|-------------|--------|-------|
| C1 | Verify CI runs integration tests | ⏳ Carry-forward | Need to confirm `-tags=integration` runs in CI |
| C2 | Mark Epic 9.5 complete | ✅ Done | Sprint-status updated |

**Result:** 1/2 action items completed, 1 carried forward.

---

## What Went Well

### 1. Interface-First Design
- `StateActivator` interface defined early (Story 11.3)
- Extended with `Hibernate()` in Story 11.5 for CLI access
- Clean separation between TUI auto-activation and CLI manual control

### 2. Consistent Code Review Process
- All 7 stories went through code review with findings addressed
- Multiple findings categories: High (H), Medium (M), Low (L)
- Common fixes: missing tests, doc comments, edge case handling

### 3. Thorough Testing
- Story 11.4: 18+ unit tests for hibernated view
- Story 11.5: 21 unit tests for CLI commands
- Story 11.7: 9 tests covering all ACs + edge cases

### 4. Pattern Reuse
- Story 11.5 followed `favorite.go` pattern for CLI commands
- Story 11.7 reused `clearRemoveFeedbackMsg` for feedback timeout
- `findProjectByIdentifier()` reused for all project lookup

### 5. Bug Fix During Epic
- Found and fixed hibernate state not persisting (two bugs):
  - `loadProjectsCmd()` used `FindAll()` instead of `FindActive()`
  - `refreshProjectsCmd()` overwrote DB state with stale in-memory data

---

## What Didn't Go Well

### 1. Story 11.5 Interface Extension
- `StateActivator` interface was initially TUI-only (Activate)
- Had to extend with `Hibernate()` for CLI access
- Required updating 2 existing test mocks

### 2. State Persistence Bug Discovery
- Bug not caught until Story 11.7 (late in epic)
- Two root causes in model.go refresh logic
- Could have been caught earlier with integration tests

---

## Issues Fixed During Epic

### Hibernate State Not Persisting (Commit 5bddc41)

**Problem:** Projects hibernated via CLI would reappear in active list after TUI restart or refresh

**Root Causes:**
1. `loadProjectsCmd()` used `FindAll()` instead of `FindActive()` - hibernated projects appeared in active list after restart
2. `refreshProjectsCmd()` saved stale in-memory state back to DB, overwriting CLI hibernate changes

**Resolution:**
- Use `FindActive()` for loading active projects
- Reload project from DB before saving in refresh to preserve state fields

---

## Action Items

### Critical Path

| # | Action Item | Owner | Status |
|---|-------------|-------|--------|
| C1 | Verify CI runs integration tests | Dev | ⏳ Carry-forward (2x) |
| C2 | Mark Epic 11 complete | SM | ✅ Done (this retro) |

### Process Improvements

| # | Action Item | Priority | Status |
|---|-------------|----------|--------|
| P1 | Add integration tests for state persistence | Medium | Backlog |

---

## Lessons Learned

1. **Interface evolution is normal** - Starting narrow (Activate-only) then extending (adding Hibernate) is cleaner than over-designing upfront

2. **Integration tests catch state bugs** - State persistence issues weren't caught until late because integration tests weren't running regularly

3. **Bug discovery during stories is OK** - Finding the persistence bug while implementing 11.7 is normal workflow, not failure

4. **Code review consistency pays off** - All 7 stories followed same review process with categorized findings

5. **Pattern reuse accelerates development** - Using favorite.go as template for hibernate/activate made Story 11.5 straightforward

---

## Epic Prioritization Decision

**Decision:** Epic 11 complete. Next epic TBD.

| Epic | Status | Notes |
|------|--------|-------|
| 10 (Scalable File Watching) | Backlog | Architecture stable after 8.13, 9.5-1, 9.5-2 fixes |
| 11 (Project Hibernation) | **Done** | This retrospective |

---

## Retrospective Metrics

| Metric | Value |
|--------|-------|
| Stories Completed | 7/7 (100%) |
| Stories Added Mid-Epic | 0 |
| Previous Action Items Resolved | 1/2 (C1 carried forward) |
| New Action Items | 2 (C2 done, P1 backlog) |
| Bugs Fixed During Epic | 1 (state persistence - commit 5bddc41) |

---

## Epic Sequence Update

| Epic | Name | Status |
|------|------|--------|
| 1-8 | MVP Epics | Done |
| 9 | TUI Behavioral Testing Infrastructure | Done |
| 9.5 | Stability & BMAD Update | Done |
| 10 | Scalable File Watching | Backlog (deferred) |
| **11** | **Project State & Hibernation** | **Done** |

---

*Retrospective facilitated by Bob (Scrum Master)*
*Document generated: 2026-01-03*
